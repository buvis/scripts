#!/usr/bin/env python
# get-next-zettelseq

# Returns the next sequence number in zettelseq filenaming scheme which I
# use for my photography.

import datetime

from pathlib import Path
from argparse import ArgumentParser

parser = ArgumentParser()
parser.add_argument(
    "-p",
    "--path",
    dest="path",
    help="path to directory to check",
)
args = parser.parse_args()


def is_zettelseq(filename):
    try:
        datetime.datetime.strptime(filename.stem[:14], "%Y%m%d%H%M%S").date()
    except ValueError:
        return False

    return True


def get_seq_from_zettelseq(zettelseq):
    return int(str(zettelseq[-4:]))


if args.path:
    if args.path == ".":
        args.path = Path.cwd()

    path_dir = args.path

    if path_dir.is_dir() is False:
        print(f"{path_dir} isn't a directory")
        exit()

    seqs = [
        get_seq_from_zettelseq(f.stem) for f in path_dir.iterdir()
        if is_zettelseq(f)
    ]
    print(f"Last sequence number in {path_dir} is {max(seqs)}")
