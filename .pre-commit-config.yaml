repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.0
    hooks:
      - id: ruff
      - id: ruff-format
  - repo: local
    hooks:
      - id: no-dev-sources
        name: block dev mode sources
        entry: bash -c 'if grep -l "tool\.uv\.sources" "$@"; then echo "^^^ dev mode active â€” run dev/finish-dev first"; exit 1; fi' --
        language: system
        files: (^src/.*/pyproject\.toml$|^bin/[^.]+$)
      - id: pytest
        name: pytest
        entry: bash -c 'for pkg in src/*/; do if [ -d "$pkg/tests" ]; then echo "=== Testing $pkg ===" && (cd "$pkg" && uv run --with pytest pytest) || exit 1; fi; done'
        language: system
        pass_filenames: false
        always_run: true
